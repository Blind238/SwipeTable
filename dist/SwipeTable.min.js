/*! SwipeTable 11-11-2013 */
var SwipeTable=function(a,b,c){"use strict";var d,e=a,f=b,g=c,h="table",i=39;h+=" table-condensed",i=33;var j,k=0,l=0,m=1,n=!0,o=function(){var a=window.matchMedia||window.msMatchMedia,b=function(a,b,c){var d=b.clientHeight,e=a.innerHeight;return c&&e>d&&!0===c("(min-height:"+e+"px)").matches?a.innerHeight:b.clientHeight}(window,document.documentElement,a);b-=i,m=Math.floor(b/i)},p=function(a){if(!a.server)return console.log("No server provided to makeRequest, not making request"),void 0;if(console.log("Making request to "+a.server+"."),a.timestamp)if(a.sortField||a.sortAsc){if(!a.sortField||!a.sortAsc)return console.log("Missing sort parameter"),void 0;a.page?q("GET",a.server+"?p="+a.page+"&ps="+m+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table):q("GET",a.server+"?ps="+m+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table)}else{if(!a.page)return console.log("Missing page, not according to spec."),void 0;q("GET",a.server+"?p="+a.page+"&ps="+m+"&ts="+a.timestamp,a.table)}else q("GET",a.server+"?ps="+m,a.table)},q=function(a,b,c){var d=new XMLHttpRequest;d.open(a,b,!0),d.onreadystatechange=function(){return 4!==d.readyState||200!==d.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),r(c,d.responseText),void 0)},d.send(null)},r=function(a,b){console.log("Parsing response."),t(a,JSON.parse(b))},s=function(){console.log("Creating Table.");var a;return function(){if(a){console.log("Giving table instance"),l+=1;var b=a.cloneNode(!0);return b}console.log("Creating new Table");var c=0,d=document.createElement("table");d.className=h;var e=document.createElement("thead"),g=document.createElement("tr");for(c;c<f.length;c+=1){var i=document.createElement("th");i.appendChild(document.createTextNode(f[c])),g.appendChild(i)}return e.appendChild(g),d.appendChild(e),console.log("Table created."),a=d.cloneNode(!0),l+=1,d}}(),t=function(a,b){console.log("Filling table.");var c=b.length;if(0!==c){var e=document.createElement("tbody");a.appendChild(e);for(var h=0;c>h;){for(var i=b[h],j=document.createElement("tr"),k=Object.keys(i).length,l=0;k>l;){var m=document.createElement("td");m.appendChild(document.createTextNode(i[f[l]])),j.appendChild(m),l+=1}e.appendChild(j),h+=1}var n=g.getElementsByClassName("st-wrap")[0],o=document.createElement("div"),p=o.cloneNode(!0),q=o.cloneNode(!0);o.className="st-table-wrap",p.className="st-scrollable",q.className="st-pinned";var r=a.cloneNode(!0);p.appendChild(a),q.appendChild(r),o.appendChild(p),o.appendChild(q),void 0!==d&&d.prepareForAddition(o),n.appendChild(o),u()}},u=function(){if(k+=1,k===l)if(void 0===d){var a=v.bind(this),b=w.bind(this);d=new Swipe(g,{continuous:!1,callback:function(b,c){b===c.parentNode.childNodes.length-1&&(console.log("fetching next item"),a())},transitionEnd:function(a,c){b(c)}}),1===k&&(v(),w(document.getElementsByClassName("st-table-wrap")[0]))}else d.setup()},v=function(){var a=d.getPos()+1,b=s();void 0===j?p({table:b,server:e,page:a+1,timestamp:10}):p({table:b,server:e,page:a+1,sortField:j,sortAsc:n})},w=function(a){var b=a.cloneNode(!0),c=g.getElementsByClassName("st-header")[0];c.innerHTML="",b.removeAttribute("style"),b.removeAttribute("data-index"),c.appendChild(b);var d=c.getElementsByClassName("st-scrollable")[0];if(d){var e=x.setPosition.bind(this),f=x.updateScrollables.bind(this);d.onscroll=function(){console.log("Scrolling is happening!"),e(this.scrollLeft),f()};var h=x.getPosition();void 0!==h?(d.scrollLeft=h,x.updateScrollables()):x.setPosition(0)}},x=function(){var a;return console.log("Entered updateScroll"),{getPosition:function(){return console.log("Getting position "+a),a},setPosition:function(b){console.log("Setting position "+b),a=b},updateScrollables:function(){console.log("Updating scrollables");var b=g.getElementsByClassName("st-wrap")[0].getElementsByClassName("st-scrollable"),c=0;for(c;c<b.length;c+=1)b[c].scrollLeft=a}}}(),y={next:function(){void 0!==d&&d.next()},prev:function(){void 0!==d&&d.prev()}};o();var z=s();console.log("dataProvider === "+e),p({table:z,server:e}),w(z);var A={nextPage:v,updateHeader:w,getScrollPosition:x.getPosition,setScrollPosition:x.setPosition,updateScrollables:x.updateScrollables,next:y.next,prev:y.prev};return A};
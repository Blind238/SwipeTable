/*! SwipeTable 13-11-2013 */
var SwipeTable=function(a,b,c,d){"use strict";var e,f,g;if("string"!=typeof a)throw new TypeError("First parameter is not a string");if(e=a,!(b instanceof Array))throw new TypeError("Second parameter is not an array");f=b,g=c;var h,i="table";i+=" table-condensed";var j,k=0,l=0,m=1,n=!0;d=d||{},"boolean"!=typeof d.fullscreen&&(d.fullscreen=!0);var o=function(){var a,b;d.fullscreen&&(a=p()),b=q(),a-=b,m=Math.floor(a/b)},p=function(){var a=window.matchMedia||window.msMatchMedia,b=function(a,b,c){var d=b.clientHeight,e=a.innerHeight;return c&&e>d&&!0===c("(min-height:"+e+"px)").matches?a.innerHeight:b.clientHeight}(window,document.documentElement,a);return b},q=function(){var a,b=document.createElement("table"),c=document.createElement("tbody"),d=document.createElement("tr"),e=document.createElement("td"),f=document.createTextNode("text"),h=g.querySelector(".st-wrap");return b.className=i,b.style.visibility="hidden",e.appendChild(f),d.appendChild(e),c.appendChild(d),b.appendChild(c),h.appendChild(b),a=d.getBoundingClientRect().height,h.innerHTML="",a},r=function(a){if(a.server)if(a.timestamp)if(a.sortField||a.sortAsc){if(!a.sortField||!a.sortAsc)return;a.page?s("GET",a.server+"?p="+a.page+"&ps="+m+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table):s("GET",a.server+"?ps="+m+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table)}else{if(!a.page)return;s("GET",a.server+"?p="+a.page+"&ps="+m+"&ts="+a.timestamp,a.table)}else s("GET",a.server+"?ps="+m,a.table)},s=function(a,b,c){var d=new XMLHttpRequest;d.open(a,b,!0),d.onreadystatechange=function(){4===d.readyState&&200===d.status&&t(c,d.responseText)},d.send(null)},t=function(a,b){v(a,JSON.parse(b))},u=function(){var a;return function(){if(a){l+=1;var b=a.cloneNode(!0);return b}var c,d,e=document.createElement("table");e.className=i;var g=document.createElement("thead"),h=document.createElement("tr");for(c=0,d=f.length;d>c;c+=1){var j=document.createElement("th");j.appendChild(document.createTextNode(f[c])),h.appendChild(j)}return g.appendChild(h),e.appendChild(g),a=e.cloneNode(!0),l+=1,e}}(),v=function(a,b){var c=b.length;if(0!==c){var d=document.createElement("tbody");a.appendChild(d);for(var e=0;c>e;){for(var i=b[e],j=document.createElement("tr"),k=Object.keys(i).length,l=0;k>l;){var m=document.createElement("td");m.appendChild(document.createTextNode(i[f[l]])),j.appendChild(m),l+=1}d.appendChild(j),e+=1}var n=g.querySelector(".st-wrap"),o=document.createElement("div"),p=o.cloneNode(!0),q=o.cloneNode(!0);o.className="st-table-wrap",p.className="st-scrollable",q.className="st-pinned";var r=a.cloneNode(!0);p.appendChild(a),q.appendChild(r),o.appendChild(p),o.appendChild(q),void 0!==h&&h.prepareForAddition(o),n.appendChild(o),w()}},w=function(){if(k+=1,k===l)if(void 0===h){var a=x.bind(this),b=y.bind(this);h=new Swipe(g,{continuous:!1,callback:function(b,c){b===c.parentNode.childNodes.length-1&&a()},transitionEnd:function(a,c){b(c)}}),1===k&&(x(),y(document.getElementsByClassName("st-table-wrap")[0]))}else h.setup()},x=function(){var a=h.getPos()+1,b=u();void 0===j?r({table:b,server:e,page:a+1,timestamp:10}):r({table:b,server:e,page:a+1,sortField:j,sortAsc:n})},y=function(a){var b=a.cloneNode(!0),c=g.querySelector(".st-header");c.innerHTML="",b.removeAttribute("style"),b.removeAttribute("data-index"),c.appendChild(b);var d=c.querySelector(".st-scrollable");if(d){var e=z.setPosition.bind(this),f=z.update.bind(this);d.onscroll=function(){e(this.scrollLeft),f()};var h=z.getPosition();void 0!==h?(d.scrollLeft=h,z.updateScrollables()):z.setPosition(0)}},z=function(){var a,b=!1;return{getPosition:function(){return a},setPosition:function(b){a=b},update:function(){if(!b){var a=z.updateScrollables.bind(this),c=z.frameRequested.bind(this);b=!0,window.requestAnimationFrame(function(){a(),c(!1)})}},updateScrollables:function(){var b=g.querySelector(".st-wrap").getElementsByClassName("st-scrollable"),c=0;for(c;c<b.length;c+=1)b[c].scrollLeft=a},frameRequested:function(a){return"undefined"!=typeof a&&"boolean"==typeof a&&(b=a),b}}}(),A={next:function(){void 0!==h&&h.next()},prev:function(){void 0!==h&&h.prev()}};o();var B=u();r({table:B,server:e}),y(B);var C={test:{init:o,makeRequest:r,executeRequest:s,parseResponse:t,createTable:u,fillTable:v,tableDone:w,updateHeader:y,updateScroll:z},nextPage:x,updateHeader:y,getScrollPosition:z.getPosition,setScrollPosition:z.setPosition,updateScrollables:z.updateScrollables,next:A.next,prev:A.prev};return C};
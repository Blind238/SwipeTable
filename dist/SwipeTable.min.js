/*! SwipeTable 08-11-2013 */
var SwipeTable=function(a,b,c){"use strict";var d=a,e=b,f=c,g="table",h=39;g+=" table-condensed",h=33;var i,j=0,k=0,l=1,m=!0,n=function(){var a=window.matchMedia||window.msMatchMedia,b=function(a,b,c){var d=b.clientHeight,e=a.innerHeight;return c&&e>d&&!0===c("(min-height:"+e+"px)").matches?a.innerHeight:b.clientHeight}(window,document.documentElement,a);b-=h,l=Math.floor(b/h)},o=function(a){if(!a.server)return console.log("No server provided to makeRequest, not making request"),void 0;if(console.log("Making request to "+a.server+"."),a.timestamp)if(a.sortField||a.sortAsc){if(!a.sortField||!a.sortAsc)return console.log("Missing sort parameter"),void 0;a.page?p("GET",a.server+"?p="+a.page+"&ps="+l+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table):p("GET",a.server+"?ps="+l+"&ts="+a.timestamp+"&sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,a.table)}else{if(!a.page)return console.log("Missing page, not according to spec."),void 0;p("GET",a.server+"?p="+a.page+"&ps="+l+"&ts="+a.timestamp,a.table)}else p("GET",a.server+"?ps="+l,a.table)},p=function(a,b,c){var d=new XMLHttpRequest;d.open(a,b,!0),d.onreadystatechange=function(){return 4!==d.readyState||200!==d.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),q(c,d.responseText),void 0)},d.send(null)},q=function(a,b){console.log("Parsing response."),s(a,JSON.parse(b))},r=function(){console.log("Creating Table.");var a;return function(){if(a){console.log("Giving table instance"),k+=1;var b=a.cloneNode(!0);return b}console.log("Creating new Table");var c=0,d=document.createElement("table");d.className=g;var f=document.createElement("thead"),h=document.createElement("tr");for(c;c<e.length;c+=1){var i=document.createElement("th");i.appendChild(document.createTextNode(e[c])),h.appendChild(i)}return f.appendChild(h),d.appendChild(f),console.log("Table created."),a=d.cloneNode(!0),k+=1,d}}(),s=function(a,b){console.log("Filling table.");var c=b.length;if(0!==c){var d=document.createElement("tbody");a.appendChild(d);for(var g=0;c>g;){for(var h=b[g],i=document.createElement("tr"),j=Object.keys(h).length,k=0;j>k;){var l=document.createElement("td");l.appendChild(document.createTextNode(h[e[k]])),i.appendChild(l),k+=1}d.appendChild(i),g+=1}var m=f.getElementsByClassName("st-wrap")[0],n=document.createElement("div"),o=n.cloneNode(!0),p=n.cloneNode(!0);n.className="st-table-wrap",o.className="st-scrollable",p.className="st-pinned";var q=a.cloneNode(!0);o.appendChild(a),p.appendChild(q),n.appendChild(o),n.appendChild(p),void 0!==window.mySwipe&&window.mySwipe.prepareForAddition(n),m.appendChild(n),t()}},t=function(){j+=1,j===k&&(void 0===window.mySwipe?(window.mySwipe=new Swipe(f,{continuous:!1,callback:function(a,b){a===b.parentNode.childNodes.length-1&&(console.log("fetching next item"),SwipeTable.nextPage())},transitionEnd:function(a,b){SwipeTable.updateHeader(b)}}),1===j&&(u(),v(document.getElementsByClassName("st-table-wrap")[0]))):window.mySwipe.setup())},u=function(){var a=window.mySwipe.getPos()+1,b=r();void 0===i?o({table:b,server:d,page:a+1,timestamp:10}):o({table:b,server:d,page:a+1,sortField:i,sortAsc:m})},v=function(a){var b=a.cloneNode(!0),c=f.getElementsByClassName("st-header")[0];c.innerHTML="",b.removeAttribute("style"),b.removeAttribute("data-index"),c.appendChild(b);var d=c.getElementsByClassName("st-scrollable")[0];if(d){d.onscroll=function(){console.log("Scrolling is happening!"),SwipeTable.setScrollPosition(this.scrollLeft),SwipeTable.updateScrollables()};var e=SwipeTable.getScrollPosition();void 0!==e?(d.scrollLeft=e,SwipeTable.updateScrollables()):SwipeTable.setScrollPosition(0)}},w=function(){var a;return console.log("Entered updateScroll"),{getPosition:function(){return console.log("Getting position "+a),a},setPosition:function(b){console.log("Setting position "+b),a=b},updateScrollables:function(){console.log("Updating scrollables");var b=document.getElementsByClassName("st-wrap")[0].getElementsByClassName("st-scrollable"),c=0;for(c;c<b.length;c+=1)b[c].scrollLeft=a}}}();n();var x=r();console.log("dataProvider === "+d),o({table:x,server:d}),v(x);var y={nextPage:u,updateHeader:v,getScrollPosition:w.getPosition,setScrollPosition:w.setPosition,updateScrollables:w.updateScrollables};return y};
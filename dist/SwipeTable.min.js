/*! SwipeTable 01-11-2013 */
var SwipeTable=function(){"use strict";var a=["id","time","time2","location","location2"],b="table",c=39;b+=" table-condensed",c=33;var d,e="/api",f=0,g=0,h=1,i=!0,j=function(){var a=window.matchMedia||window.msMatchMedia,b=function(a,b,c){var d=b.clientHeight,e=a.innerHeight;return c&&e>d&&!0===c("(min-height:"+e+"px)").matches?a.innerHeight:b.clientHeight}(window,document.documentElement,a);b-=c,h=Math.floor(b/c)},k=function(a){if(!a.server)return console.log("No server provided to makeRequest, not making request"),void 0;console.log("Making request to "+a.server+".");var b=new XMLHttpRequest;if(a.timestamp)if(a.sortField||a.sortAsc){if(!a.sortField||!a.sortAsc)return console.log("Missing sort parameter"),void 0;a.page?(b.open("GET",a.server+"?p="+a.page+"&ps="+h+"&ts="+a.timestamp+"sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),l(a.table,b.responseText),void 0)}):(b.open("GET",a.server+"?ps="+h+"&ts="+a.timestamp+"sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),l(a.table,b.responseText),void 0)})}else{if(!a.page)return console.log("Missing page, not according to spec."),void 0;b.open("GET",a.server+"?p="+a.page+"&ps="+h+"&ts="+a.timestamp,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),l(a.table,b.responseText),void 0)}}else b.open("GET",a.server+"?&ps="+h,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),l(a.table,b.responseText),void 0)};b.send(null)},l=function(a,b){console.log("Parsing response."),n(a,JSON.parse(b))},m=function(){console.log("Creating Table.");var c;return function(){if(c){console.log("Giving table instance"),g+=1;var d=c.cloneNode(!0);return d}console.log("Creating new Table");var e=0,f=document.createElement("table");f.className=b;var h=document.createElement("thead"),i=document.createElement("tr");for(e;e<a.length;e+=1){var j=document.createElement("th");j.appendChild(document.createTextNode(a[e])),i.appendChild(j)}return h.appendChild(i),f.appendChild(h),console.log("Table created."),c=f.cloneNode(!0),g+=1,f}}(),n=function(b,c){console.log("Filling table.");var d=c.length;if(0!==d){var e=document.createElement("tbody");b.appendChild(e);for(var f=0;d>f;){for(var g=c[f],h=document.createElement("tr"),i=Object.keys(g).length,j=0;i>j;){var k=document.createElement("td");k.appendChild(document.createTextNode(g[a[j]])),h.appendChild(k),j+=1}e.appendChild(h),f+=1}var l=document.getElementsByClassName("st-wrap")[0],m=document.createElement("div"),n=m.cloneNode(!0),p=m.cloneNode(!0);m.className="st-table-wrap",n.className="st-scrollable",p.className="st-pinned";var q=b.cloneNode(!0);n.appendChild(b),p.appendChild(q),m.appendChild(n),m.appendChild(p),void 0!==window.mySwipe&&window.mySwipe.prepareForAddition(m),l.appendChild(m),o()}},o=function(){f+=1,f===g&&(void 0===window.mySwipe?(window.mySwipe=new Swipe(document.getElementsByClassName("swipe-table")[0],{continuous:!1,callback:function(a,b){a===b.parentNode.childNodes.length-1&&(console.log("fetching next item"),SwipeTable.nextPage())},transitionEnd:function(a,b){SwipeTable.updateHeader(b)}}),1===f&&(p(),q(document.getElementsByClassName("st-table-wrap")[0]))):window.mySwipe.setup())},p=function(){var a=window.mySwipe.getPos()+1,b=m();void 0===d?k({table:b,server:e,page:a+1,timestamp:10}):k({table:b,server:e,page:a+1,sortField:d,sortAsc:i})},q=function(a){var b=a.cloneNode(!0),c=document.getElementsByClassName("swipe-table-header")[0];c.innerHTML="",b.removeAttribute("style"),b.removeAttribute("data-index"),c.appendChild(b);var d=c.getElementsByClassName("st-scrollable")[0];if(d){d.onscroll=function(){console.log("Scrolling is happening!"),SwipeTable.setScrollPosition(this.scrollLeft),SwipeTable.updateScrollables()};var e=SwipeTable.getScrollPosition();void 0!==e?(d.scrollLeft=e,SwipeTable.updateScrollables()):SwipeTable.setScrollPosition(0)}},r=function(){var a;return console.log("Entered updateScroll"),{getPosition:function(){return console.log("Getting position "+a),a},setPosition:function(b){console.log("Setting position "+b),a=b},updateScrollables:function(){console.log("Updating scrollables");var b=document.getElementsByClassName("st-wrap")[0].getElementsByClassName("st-scrollable"),c=0;for(c;c<b.length;c+=1)b[c].scrollLeft=a}}}();j();var s=m();console.log("dataProvider === "+e),k({table:s,server:e}),q(s);var t={nextPage:p,updateHeader:q,getScrollPosition:r.getPosition,setScrollPosition:r.setPosition,updateScrollables:r.updateScrollables};return t};
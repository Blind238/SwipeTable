/*! SwipeTable 30-10-2013 */
!function(a,b){"use strict";var c=function(){var a=["id","time","time2","location","location2"],d="table",e=39;d+=" table-condensed",e=33;var f,g="/api",h=0,i=0,j=1,k=!0,l=function(){var a=window.matchMedia||window.msMatchMedia,b=function(a,b,c){var d=b.clientHeight,e=a.innerHeight;return c&&e>d&&!0===c("(min-height:"+e+"px)").matches?a.innerHeight:b.clientHeight}(window,document.documentElement,a);b-=e,j=Math.floor(b/e)},m=function(a){if(!a.server)return console.log("No server provided to makeRequest, not making request"),void 0;console.log("Making request to "+a.server+".");var b=new XMLHttpRequest;if(a.timestamp)if(a.sortField||a.sortAsc){if(!a.sortField||!a.sortAsc)return console.log("Missing sort parameter"),void 0;a.page?(b.open("GET",a.server+"?p="+a.page+"&ps="+j+"&ts="+a.timestamp+"sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),n(a.table,b.responseText),void 0)}):(b.open("GET",a.server+"?ps="+j+"&ts="+a.timestamp+"sort[field]="+a.sortField+"&sort[asc]="+a.sortAsc,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),n(a.table,b.responseText),void 0)})}else{if(!a.page)return console.log("Missing page, not according to spec."),void 0;b.open("GET",a.server+"?p="+a.page+"&ps="+j+"&ts="+a.timestamp,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),n(a.table,b.responseText),void 0)}}else b.open("GET",a.server+"?&ps="+j,!0),b.onreadystatechange=function(){return 4!==b.readyState||200!==b.status?(console.log("Request went sour"),void 0):(console.log("Request successful."),n(a.table,b.responseText),void 0)};b.send(null)},n=function(a,b){console.log("Parsing response."),p(a,JSON.parse(b))},o=function(){console.log("Creating Table.");var b;return function(){if(b){console.log("Giving table instance"),i+=1;var c=b.cloneNode(!0);return c}console.log("Creating new Table");var e=0,f=document.createElement("table");f.className=d;var g=document.createElement("thead"),h=document.createElement("tr");for(e;e<a.length;e+=1){var j=document.createElement("th");j.appendChild(document.createTextNode(a[e])),h.appendChild(j)}return g.appendChild(h),f.appendChild(g),console.log("Table created."),b=f.cloneNode(!0),i+=1,f}}(),p=function(c,d){console.log("Filling table.");var e=d.length;if(0!==e){var f=document.createElement("tbody");c.appendChild(f);for(var g=0;e>g;){for(var h=d[g],i=document.createElement("tr"),j=Object.keys(h).length,k=0;j>k;){var l=document.createElement("td");l.appendChild(document.createTextNode(h[a[k]])),i.appendChild(l),k+=1}f.appendChild(i),g+=1}var m=document.getElementsByClassName("st-wrap")[0],n=document.createElement("div"),o=n.cloneNode(!0),p=n.cloneNode(!0);n.className="st-table-wrap",o.className="st-scrollable",p.className="st-pinned";var r=c.cloneNode(!0);o.appendChild(c),p.appendChild(r),n.appendChild(o),n.appendChild(p),window.mySwipe!==b&&window.mySwipe.prepareForAddition(n),m.appendChild(n),q()}},q=function(){h+=1,h===i&&(window.mySwipe===b?(window.mySwipe=Swipe(document.getElementsByClassName("swipe-table")[0],{continuous:!1,callback:function(a,b){a===b.parentNode.childNodes.length-1&&(console.log("fetching next item"),c.nextPage())},transitionEnd:function(a,b){c.updateHeader(b)}}),1===h&&(r(),s(document.getElementsByClassName("st-table-wrap")[0]))):window.mySwipe.setup())},r=function(){var a=window.mySwipe.getPos()+1,c=o();f===b?m({table:c,server:g,page:a+1,timestamp:10}):m({table:c,server:g,page:a+1,sortField:f,sortAsc:k})},s=function(a){var d=a.cloneNode(!0),e=document.getElementsByClassName("swipe-table-header")[0];e.innerHTML="",d.removeAttribute("style"),d.removeAttribute("data-index"),e.appendChild(d);var f=e.getElementsByClassName("st-scrollable")[0];if(f){f.onscroll=function(){console.log("Scrolling is happening!"),c.setScrollPosition(this.scrollLeft),c.updateScrollables()};var g=c.getScrollPosition();g!==b?(f.scrollLeft=g,c.updateScrollables()):c.setScrollPosition(0)}},t=function(){var a;return console.log("Entered updateScroll"),{getPosition:function(){return console.log("Getting position "+a),a},setPosition:function(b){console.log("Setting position "+b),a=b},updateScrollables:function(){console.log("Updating scrollables");var b=document.getElementsByClassName("st-wrap")[0].getElementsByClassName("st-scrollable"),c=0;for(c;c<b.length;c+=1)b[c].scrollLeft=a}}}();l();var u=o();console.log("dataProvider === "+g),m({table:u,server:g}),s(u);var v={nextPage:r,updateHeader:s,getScrollPosition:t.getPosition,setScrollPosition:t.setPosition,updateScrollables:t.updateScrollables};return v};c.VERSION="0.0.0",a.SwipeTable=c}(this);